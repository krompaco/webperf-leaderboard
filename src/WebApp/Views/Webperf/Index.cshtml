@using System.Globalization
@model WebApp.Services.Generated.WebperfIndexResponse
@{
	var headings = new[] { "Lighthouse", "404-sida", "W3C HTML", "W3C CSS", "Webbkoll", "unknown", "unknown", "unknown", "unknown", "unknown" };
}

<h2 class="font-bold text-xl mb-3 pt-6">Testresultat från <a class="text-blue-800 underline hover:text-blue-900" href="https://github.com/Webperf-se/webperf_core">Webperf-se/webperf_core</a></h2>

@if (Model.Sites.Count > 0)
{
	var rank = 0;
	<ul class="mb-12">
		@foreach (var site in Model.Sites)
		{
			rank++;
			var i = 0;
			<li class="mb-8 @(rank == 1 ? "pt-8" : "pt-8 border-t border-gray-600")">
				<div class="flex flex-wrap">
					<div class="w-full sm:w-1/2 lg:w-1/3 xl:w-2/12">
						<div class="p-3 bg-gray-200 sm:mr-3">
							<h3 class="text-lg mb-4">
								<span class="flex items-center mb-3">
									<span class="block mr-2">#@rank</span>
									<span class="rounded-full bg-black px-3 py-2 text-lg text-white font-bold">@site.Rating.ToString("0.0", new CultureInfo("en-US"))</span>
								</span>
								<a class="block text-blue-800 underline hover:text-blue-900" href="@site.Url">@site.Title</a>
							</h3>
							<p class="text-sm">Kördes mellan @site.Tests.Min(x => x.TestDate).ToString("yyyy-MM-dd HH:mm:ss") och @site.Tests.Max(x => x.TestDate).ToString("HH:mm:ss", new CultureInfo("en-US")).</p>
						</div>
					</div>
					@if (site.Tests.Count == 5)
					{
						@foreach (var test in site.Tests)
						{
							<div class="p-3 w-full sm:w-1/2 md:w-1/3 xl:w-2/12">
								<h4 class="flex items-center text-lg mb-2">
									<span class="mr-2">@headings[i]</span>
									<span class="rounded-full bg-black px-2 py-1 text-sm text-white font-bold">@test.Rating.ToString("0.0", new CultureInfo("en-US"))</span>
								</h4>
								@Html.Raw(Markdig.Markdown.ToHtml(test.ReportText).Replace("<li>", "<li class=\"mb-1 text-sm\">").Replace("<ul>", "<ul class=\"list-disc list-outside ml-4\">"))
							</div>
							i++;
						}
					}
					else
					{
						<div class="p-3 w-full sm:w-1/2 md:w-1/3 xl:w-2/12">
							<h4 class="flex items-center text-lg mb-2">
								<span class="mr-2">Fel inträffade vid senaste körningen</span>
							</h4>
						</div>
					}
				</div>
			</li>
		}
	</ul>
}

